<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <script src="https://unpkg.com/callapp-lib"></script>
  <style>
    body {
      height: 400vh;
    }
  </style>
</head>

<body>
  <h1 id="app">callApp</h1>
  <br><br>
  <h2 id="intent">intent off</h2>
  <br><br>
  <h1 id="native">native</h1>
  <br><br>
  <div id="acb"></div>
</body>
<script>
  var timeout = 2000;
  var options = {
    scheme: {
      protocol: "coinmarketcap",
      host: "https://coinmarketcap.com/link",
    },
    appstore: "https://apps.apple.com/app/coinmarketcap/id1282107098?ls=1",
    timeout: timeout,
    fallback: "",
  };

  var intent = document.getElementById('intent');
  intent.onclick = function () {
    if (intent.innerText === 'intent off') {
      options.intent = {
        scheme: "coinmarketcap",
        package: "com.coinmarketcap.android",
      };
      intent.innerText = 'intent on'
    } else {
      delete options.intent;
      intent.innerText = 'intent off'
    }
  }

  document.getElementById("app").onclick = function () {
    var callLib = new CallApp(options);
    callLib.open({
      // param: {},
      path: "",
    });
  };


  document.getElementById("native").onclick = function () {
    var schema = `coinmarketcap://https://coinmarketcap.com/link`;
    var start = Date.now();
    var timeDiff = 100;
    // tryScroll();
    var timer = setTimeout(() => {
      if (Date.now() - start > timeout + timeDiff) clearTimeout(timer);
      var appStore = "https://apps.apple.com/app/coinmarketcap/id1282107098?ls=1";
      var googleplay = "https://www.google.com.hk/search?q=cmc";
      var inIos = navigator.userAgent.toLowerCase().includes('iphone');
      location.href = inIos ? appStore : googleplay;
    }, timeout);
    location.href = schema;
  };

  function tryScroll() {
    setInterval(() => {
      var _top = document.documentElement.scrollTop + 30;
      document.documentElement.scrollTop = _top;
      var nowTop = document.documentElement.scrollTop;

      document.getElementById('acb').innerText = `${_top} : ${nowTop}`;
    }, 100);
  }

</script>

</html>
